{% extends 'base.html' %}
{% block script %}
<script>
    $(document).ready(function() {
        $("#btnAddCombo").click(function(){
            $("#comboAddForm").toggle();
        });

        $("#btnAddPromo").click(function(){
            $("#promoDishAddForm").toggle();
        });

        $("#btnAddPromoRest").click(function(){
            $("#promoDishAddFormRest").toggle();
        });

        $("#btnAddSubcategory").click(function(){
            $("#subCatAddForm").toggle();
        });

        $("#btnAddSubcategoryDish").click(function(){
            $("#subDishAddForm").toggle();
        });

        $("#btnDelSubcategory").click(function(){
            $("#subCatDelForm").toggle();
        });

        $("#btnAddCmd").click(function(){
            $("#searchWordForm").toggle();
        });

        $("#btnDelCmd").click(function(){
            $("#searchWordDelForm").toggle();
        });

        {% for search_word in search_words %}
            $("#btnCmdAddDish_{{search_word.id}}").click(function(){
                $("#searchDishAddForm_{{search_word.id}}").toggle();
            });
        {% endfor %}

        {% for restaurant in restaurants %}
            $("#btnRestEdit" + {{ restaurant.id }}).click(function(){
                $("#restEdit" + {{ restaurant.id }}).toggle();
            });
            $("#btnRestDisable" + {{ restaurant.id }}).click(function(){
                $("#restDisable" + {{ restaurant.id }}).toggle();
            });
            $("#btnRestInfo" + {{ restaurant.id }}).click(function(){
                $("#restInfo" + {{ restaurant.id }}).toggle();
            });
        {% endfor %}

        {% for dish in dishes %}
            $("#btnDishEdit" + {{dish.id}}).click(function(){
                $(".dishEditForm" + {{dish.id}}).toggle();
                if($("#btnDishEdit" + {{dish.id}}).html() == "Скрыть"){
                    $("#btnDishEdit" + {{dish.id}}).html("Изменить");
                } else {
                    $("#btnDishEdit" + {{dish.id}}).html("Скрыть");
                }
            });
            $("#btnDishEditRest" + {{dish.id}}).click(function(){
                $(".dishEditRestForm" + {{dish.id}}).toggle();
                if($("#btnDishEditRest" + {{dish.id}}).html() == "Скрыть"){
                    $("#btnDishEditRest" + {{dish.id}}).html("Изменить");
                } else {
                    $("#btnDishEditRest" + {{dish.id}}).html("Скрыть");
                }
            });
        {% endfor %}
        $(".dish-status").click(function(){
            console.log($(this).attr("id"));
            let dish_id = $(this).attr("id").slice(13);
            method = $(this).text();
            $.ajax({
                url: "/admin/data",
                data: {"dish_id": dish_id, "method": method},
                type: "POST",
                success: function(){
                    let name = {"Выключить": "Включить", "Включить": "Выключить"};
                    $("#btnDishStatus" + dish_id).html(name[$("#btnDishStatus" + dish_id).text()]);
                }
            });
        });
    });
</script>
{% endblock %}
{% block title %}
    Панель администрирования
{% endblock %}

{% block content %}
    {% set ns = namespace (rest_id = 0, condition = False) %}
<h2 xmlns="http://www.w3.org/1999/html" xmlns="http://www.w3.org/1999/html" style="margin-top:25px;margin-bottom:25px;">Личный кабинет</h2>
        {% if current_user.ownership == 'all' %}
            <ul>Вы администратор всех ресторанов</ul>
                <div class="accordion" id="accordionRests">
                    <div class="card">
                    {% for restaurant in restaurants %}
                        {% if restaurant.id == 1 %}
                        <div class="card-header" id="headingAdmin">
                            <h5 class="mb-0">
                                <button class="btn btn-link btn-block text-left collapsed" type="button" data-toggle="collapse" data-target="#collapseAdmin" aria-expanded="false" aria-controls="collapseAdmin">
                                    {{ restaurant.name }}
                                </button>
                            </h5>
                        </div>
                        <div id="collapseAdmin" class="collapse" aria-labelledby="headingAdmin" data-parent="#accordionRests">
                            <div class="card-body">
                                <div class="accordion" id="accordionAdminCat">
                                    {% for category in categories %}
                                        {% if category.restaurant_id == restaurant.id %}
                                            <div class="card">
                                                <div class="card-header" id="headingAdminCat{{category.id}}">
                                                    <h5 class="mb-0">
                                                        <button class="btn btn-link btn-block text-left collapsed" type="button" data-toggle="collapse" data-target="#collapseAdminCat{{category.id}}" aria-expanded="false" aria-controls="collapseAdminCat{{category.id}}">
                                                            {{ category.name }}
                                                        </button>
                                                    </h5>
                                                </div>
                                            </div>
                                            <div id="collapseAdminCat{{category.id}}" class="collapse">
                                                {% if category.name == "Рекомендуем" %}
                                                {% for subcategory in subcategories %}
                                                    {% if subcategory.category_id == category.id %}
                                                        <div class="accordion" id="accordionAdminSubcat">
                                                            <div class="card">
                                                                <div class="card-header" id="headingAdminSubcat{{subcategory.id}}">
                                                                    <h5 class="mb-0">
                                                                        <button class="btn btn-link btn-block text-left collapsed" type="button" data-toggle="collapse" data-target="#collapseAdminSubcat{{subcategory.id}}" aria-expanded="false" aria-controls="collapseAdminSubcat{{subcategory.id}}">
                                                                            {{ subcategory.name }}
                                                                        </button>
                                                                    </h5>
                                                                </div>
                                                            </div>
                                                            <div id="collapseAdminSubcat{{subcategory.id}}" class="collapse">
                                                                <table class="table">
                                                                    <thead>
                                                                        <tr>
                                                                            <th scope="col">Название блюда</th>
                                                                            <th scope="col">Стоимость</th>
                                                                            <th scope="col">Описание</th>
                                                                            <th scope="col">Категория</th>
                                                                            <th scope="col">Изображение</th>
                                                                            <th scope="col"></th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                    {% for s_dish in s_dishes %}
                                                                        {% if subcategory.id == s_dish.subcat_id %}
                                                                        {% for dish in dishes %}
                                                                            {% if dish.id == s_dish.dish_id %}
                                                                            <tr>
                                                                                <td style="vertical-align: middle;">{{ dish.name }}</td>
                                                                                <td style="vertical-align: middle;">{{ dish.cost }} р.</td>
                                                                                <td style="vertical-align: middle;">{{ dish.composition }}</td>
                                                                                <td style="vertical-align: middle;">{{ dish.category }}</td>
                                                                                <td style="vertical-align: middle;"><img src="{{ dish.img_link }}" height=100 width=100 align="center"></td>
                                                                                <td style="vertical-align: middle;">
                                                                                    <form method="post">
                                                                                        {{ special_dish_delete_form.csrf_token(id="special_dish" + dish.id|string + "_delete_form_csrf") }}
                                                                                        {{ special_dish_delete_form.special_dish_id(hidden=True, value=s_dish.id, id="special_dish_" + dish.id|string + "_delete_id") }}
                                                                                        {{ special_dish_delete_form.special_dish_delete_submit(class="btn btn-danger", id="special_dish_" + s_dish.id|string + "_delete_submit_field") }}
                                                                                    </form>
                                                                                </td>
                                                                            </tr>
                                                                            {% endif %}
                                                                        {% endfor %}
                                                                        {% endif %}
                                                                    {% endfor %}
                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                    {% endif %}
                                                {% endfor %}
                                                <button id="btnAddSubcategoryDish" type="button">Добавить блюдо</button>
                                                <form id="subDishAddForm" style="display:none;white-space:pre;" method="post" enctype="multipart/form-data">
                                                    {{ special_dish_form.csrf_token() }}
                                                    <table class="table">
                                                        <tr>
                                                            <td>{{ special_dish_form.rest_id.label }}</td>
                                                            <td>
                                                                {{ special_dish_form.rest_id(hidden=true) }}
                                                                <select id="s_dish_rest_selector" name="s_dish_rest_selector" onchange="sDishAddCategory();" required>
                                                                    <option selected disabled></option>
                                                                    {% for restaurant in restaurants %}
                                                                        <option value="{{ restaurant.id }}">{{ restaurant.name }}</option>
                                                                    {% endfor %}
                                                                </select>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td>{{ special_dish_form.category_id.label }}</td>
                                                            <td>
                                                                {{ special_dish_form.category_id(hidden=true) }}
                                                                <select id="s_dish_cat_selector" name="s_dish_cat_selector" required>
                                                                    <option selected disabled></option>
                                                                </select>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td>{{ special_dish_form.dish_id.label }}</td>
                                                            <td>
                                                                {{ special_dish_form.dish_id(hidden=true) }}
                                                                <select id="s_dish_selector" name="s_dish_selector" required>
                                                                    <option selected disabled></option>
                                                                </select>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td>{{ special_dish_form.subcat_id.label }}</td>
                                                            <td>
                                                                {{ special_dish_form.subcat_id(hidden=true) }}
                                                                <select id="s_dish_subcat_selector" name="s_dish_subcat_selector" required>
                                                                    <option selected disabled></option>
                                                                </select>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td>{{ special_dish_form.s_dish_add_submit(class="btn btn-warning") }}</td>
                                                        </tr>
                                                    </table>
                                                </form>
                                                <script>
                                                    function sDishAddCategory() {
                                                        let s_dish_category_select = document.getElementById('s_dish_cat_selector');
                                                        let optionsHTMLCategory = '';
                                                        var s_dish_rest_id = document.getElementById('s_dish_rest_selector').value;
                                                        {% for category in categories %}
                                                            if ( s_dish_rest_id == {{ category.restaurant_id|safe }} ) {
                                                                optionsHTMLCategory += '<option value="{{ category.id|safe }}">{{ category.name|safe }}</option>';
                                                            }
                                                        {% endfor %}
                                                        s_dish_category_select.innerHTML = optionsHTMLCategory;
                                                        $('#s_dish_cat_selector').on('change', function() {
                                                            let s_dish_select = document.getElementById('s_dish_selector');
                                                            let optionsHTMLDishes = '';
                                                            let s_dish_rest_id = $("#s_dish_rest_selector").val();
                                                            let s_dish_cat_text = $("#s_dish_cat_selector option:selected").text();
                                                            {% for dish in dishes %}
                                                                if (s_dish_rest_id == Number('{{ dish.id_rest }}') && s_dish_cat_text == '{{ dish.category }}') {
                                                                    optionsHTMLDishes += '<option value="{{ dish.id|safe }}">{{ dish.name|safe }}</option>';
                                                                }
                                                            {% endfor %}
                                                            s_dish_select.innerHTML = optionsHTMLDishes;
                                                        });
                                                        let s_dish_subcat_select = document.getElementById('s_dish_subcat_selector');
                                                        let optionsHTMLSubcat = '';
                                                        {% for subcategory in subcategories %}
                                                            optionsHTMLSubcat += '<option value="{{ subcategory.id|safe }}">{{ subcategory.name|safe }}</option>';
                                                        {% endfor %}
                                                        s_dish_subcat_select.innerHTML = optionsHTMLSubcat;
                                                    };
                                                </script>
                                                <div style="margin-bottom:10px"></div>
                                                <button id="btnAddSubcategory" type="button">Добавить подкатегорию</button>
                                                <form id="subCatAddForm" style="display:none;white-space:pre;" method="POST" enctype="multipart/form-data">
                                                    {{ subcategory_add_form.csrf_token() }}
                                                    <table class="table">
                                                        <tbody>
                                                            <tr>
                                                                <td>{{ subcategory_add_form.name.label }}</td>
                                                                <td>{{ subcategory_add_form.name }}</td>
                                                            </tr>
                                                            {{ subcategory_add_form.category_id(value=category.id, hidden=true) }}
                                                            <tr>
                                                                <td>{{ subcategory_add_form.subcategory_add_submit(class="btn btn-warning") }}</td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </form>
                                                <div style="margin-bottom:10px"></div>
                                                <button id="btnDelSubcategory" type="button">Удалить подкатегорию</button>
                                                <form id="subCatDelForm" style="display:none;white-space:pre;" method="POST" enctype="multipart/form-data">
                                                    {{ subcategory_del_form.csrf_token() }}
                                                    <table class="table">
                                                        <tbody>
                                                            <tr>
                                                                <td>Подкатегория</td>
                                                                <td>
                                                                    {{ subcategory_del_form.subcategory_id(hidden=true) }}
                                                                    <select id="subcat_del_selector" name="subcat_del_selector" required>
                                                                        <option selected disabled></option>
                                                                    </select>
                                                                </td>
                                                                <td>{{ subcategory_del_form.subcategory_del_submit(class="btn btn-warning") }}</td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </form>
                                                <script>
                                                    let subcategory_select = document.getElementById('subcat_del_selector');
                                                    let optionsHTMLCategory = '';
                                                    {% for subcategory in subcategories %}
                                                            optionsHTMLCategory += '<option value="{{ subcategory.id|safe }}">{{ subcategory.name|safe }}</option>';
                                                    {% endfor %}
                                                    subcategory_select.innerHTML = optionsHTMLCategory;
                                                </script>
                                                <div style="margin-bottom:10px"></div>
                                                {% elif category.name == "Комбо Наборы" %}
                                                <table class="table">
                                                    <thead>
                                                        <tr>
                                                            <th scope="col">Название блюда</th>
                                                            <th scope="col">Стоимость</th>
                                                            <th scope="col">Описание</th>
                                                            <th scope="col">Категория</th>
                                                            <th scope="col">Изображение</th>
                                                            <th scope="col"></th>
                                                            <th></th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                    {% for s_dish in s_dishes %}
                                                        {% if s_dish.subcat_id == -1 %}
                                                            {% for dish in dishes %}
                                                                {% if dish.id == s_dish.dish_id %}
                                                                <tr>
                                                                    <td style="vertical-align: middle;">{{ dish.name }}</td>
                                                                    <td style="vertical-align: middle;">{{ dish.cost }} р.</td>
                                                                    <td style="vertical-align: middle;">{{ dish.composition }}</td>
                                                                    <td style="vertical-align: middle;">{{ dish.category }}</td>
                                                                    <td style="vertical-align: middle;"><img src="{{ dish.img_link }}" height=100 width=100 align="center"></td>
                                                                    <td style="vertical-align: middle;">
                                                                        <form method="post">
                                                                            {{ special_dish_delete_form.csrf_token(id="special_dish" + dish.id|string + "_delete_form_csrf") }}
                                                                            {{ special_dish_delete_form.special_dish_id(hidden=True, value=s_dish.id, id="special_dish_" + dish.id|string + "_delete_id") }}
                                                                            {{ special_dish_delete_form.special_dish_delete_submit(class="btn btn-danger", id="special_dish_" + s_dish.id|string + "_delete_submit_field") }}
                                                                        </form>
                                                                    </td>
                                                                </tr>
                                                                {% endif %}
                                                            {% endfor %}
                                                        {% endif %}
                                                    {% endfor %}
                                                    </tbody>
                                                </table>
                                                <button id="btnAddCombo" type="button">Добавить КБ</button>
                                                <form id="comboAddForm" style="display:none;white-space:pre;" method="post" enctype="multipart/form-data">
                                                    {{ special_dish_form.csrf_token() }}
                                                    <table class="table">
                                                        <tr>
                                                            <td>{{ special_dish_form.rest_id.label }}</td>
                                                            <td>
                                                                {{ special_dish_form.rest_id(hidden=true) }}
                                                                <select id="combo_rest_selector" name="combo_rest_selector" onchange="comboAddFunc();" required>
                                                                    <option selected disabled></option>
                                                                    {% for restaurant in restaurants %}
                                                                        <option value="{{ restaurant.id }}">{{ restaurant.name }}</option>
                                                                    {% endfor %}
                                                                </select>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td>{{ special_dish_form.category_id.label }}</td>
                                                            <td>
                                                                {{ special_dish_form.category_id(hidden=true) }}
                                                                <select id="combo_cat_selector" name="combo_cat_selector" required>
                                                                    <option selected disabled></option>
                                                                </select>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td>{{ special_dish_form.dish_id.label }}</td>
                                                            <td>
                                                                {{ special_dish_form.dish_id(hidden=true) }}
                                                                <select id="combo_selector" name="combo_selector" required>
                                                                    <option selected disabled></option>
                                                                </select>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td>
                                                                {{ special_dish_form.subcat_id(hidden=true, value=-1) }}
                                                                {{ special_dish_form.s_dish_add_submit(class="btn btn-warning") }}
                                                            </td>
                                                        </tr>
                                                    </table>
                                                </form>
                                                <script>
                                                    function comboAddFunc() {
                                                        let combo_category_select = document.getElementById('combo_cat_selector');
                                                        let optionsHTMLCategory = '';
                                                        var combo_rest_id = document.getElementById('combo_rest_selector').value;
                                                        {% for category in categories %}
                                                            if ( combo_rest_id == {{ category.restaurant_id|safe }} ) {
                                                                optionsHTMLCategory += '<option value="{{ category.id|safe }}">{{ category.name|safe }}</option>';
                                                            }
                                                        {% endfor %}
                                                        combo_category_select.innerHTML = optionsHTMLCategory;
                                                        $('#combo_cat_selector').on('change', function() {
                                                            let combo_select = document.getElementById('combo_selector');
                                                            let optionsHTMLDishes = '';
                                                            let combo_rest_id = $("#combo_rest_selector").val();
                                                            let combo_cat_text = $("#combo_cat_selector option:selected").text();
                                                            {% for dish in dishes %}
                                                                if (combo_rest_id == Number('{{ dish.id_rest }}') && combo_cat_text == '{{ dish.category }}') {
                                                                    optionsHTMLDishes += '<option value="{{ dish.id|safe }}">{{ dish.name|safe }}</option>';
                                                                }
                                                            {% endfor %}
                                                            combo_select.innerHTML = optionsHTMLDishes;
                                                        });
                                                    };
                                                </script>
                                                <div style="margin-bottom:10px"></div>
                                                {% elif category.name == "Акции" %}
                                                <table class="table">
                                                    <thead>
                                                        <tr>
                                                            <th scope="col">Ресторан</th>
                                                            <th scope="col">Изображение</th>
                                                            <th scope="col"></th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                    {% for promo_dish in promo_dishes %}
                                                        <tr>
                                                            <td style="vertical-align: middle;">
                                                                {% for restaurant in restaurants %}
                                                                    {% if restaurant.id == promo_dish.rest_id %}
                                                                        {{ restaurant.name }}
                                                                    {% endif %}
                                                                {% endfor %}
                                                            </td>
                                                            <td style="vertical-align: middle;"><img src="{{ promo_dish.img_link }}" height=100 width=100 align="center"></td>
                                                            <td>
                                                                <form id="promoDishDeleteForm" method="post" enctype="multipart/form-data">
                                                                    {{ promo_dishes_delete_form.csrf_token() }}
                                                                    {{ promo_dishes_delete_form.promo_dish_id(value=promo_dish.id, hidden=true) }}
                                                                    {{ promo_dishes_delete_form.promo_dish_delete_submit(class="btn btn-danger") }}
                                                                </form>
                                                            </td>
                                                        </tr>
                                                    {% endfor %}
                                                    </tbody>
                                                </table>
                                                <button id="btnAddPromo" type="button">Добавить акцию</button>
                                                <form id="promoDishAddForm" style="display:none;white-space:pre;" method="post" enctype="multipart/form-data">
                                                    {{ promo_dishes_form.csrf_token() }}
                                                    <table class="table">
                                                        {{ promo_dishes_form.rest_id(hidden=true, value=ns.rest_id) }}
                                                        {{ promo_dishes_form.selected(hidden=true, value=False) }}
                                                        <tr>
                                                            <td>{{ promo_dishes_form.rest_id.label }}</td>
                                                            <td>
                                                                <select id="promo_rest_selector" name="promo_rest_selector" onchange="promoRestSelFunc();" required>
                                                                    <option selected disabled></option>
                                                                    {% for restaurant in restaurants %}
                                                                        <option value="{{ restaurant.id }}">{{ restaurant.name }}</option>
                                                                    {% endfor %}
                                                                </select>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td>{{ promo_dishes_form.img_file.label }}</td>
                                                            <td>{{ promo_dishes_form.img_file }}</td>
                                                        </tr>
                                                        <tr>
                                                            <td>
                                                                {{ promo_dishes_form.promo_dish_submit(class="btn btn-warning") }}
                                                            </td>
                                                        </tr>
                                                    </table>
                                                </form>
                                                <div style="margin-bottom:10px"></div>
                                                {% endif %}
                                            </div>
                                        {% endif %}
                                    {% endfor %}
                                    <div class="card">
                                        <div class="card-header" id="headingAdminCommandRest{{ restaurant.id }}">
                                            <h5 class="mb-0">
                                                <button class="btn btn-link btn-block text-left collapsed" type="button" data-toggle="collapse" data-target="#collapseAdminCommandRest{{ restaurant.id }}" aria-expanded="false" aria-controls="collapseAdminCommandRest{{ restaurant.id }}">
                                                    <div>Команды</div>
                                                </button>
                                            </h5>
                                        </div>
                                        <div id="collapseAdminCommandRest{{ restaurant.id }}" class="collapse">
                                            <div class="accordion" id="accordionAdminSubCommandRest{{ restaurant.id }}">
                                                {% for search_word in search_words %}
                                                <div class="card">
                                                    <div class="card-header" id="headingAdminSubCommand{{ search_word.id }}">
                                                        <h5 class="mb-0">
                                                            <button class="btn btn-link btn-block text-left collapsed" type="button" data-toggle="collapse" data-target="#collapseAdminSubCommand{{ search_word.id }}" aria-expanded="false" aria-controls="collapseAdminSubCommand{{ search_word.id }}">
                                                                <div>{{ search_word.name }}</div>
                                                            </button>
                                                        </h5>
                                                    </div>
                                                </div>
                                                <div id="collapseAdminSubCommand{{ search_word.id }}" class="collapse">
                                                    <table class="table">
                                                        <thead>
                                                            <tr>
                                                                <th scope="col"></th>
                                                                <th scope="col">Название блюда</th>
                                                                <th scope="col">Ресторан</th>
                                                                <th scope="col"></th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            {% for search_dish in search_dishes %}
                                                                {% if search_dish.search_words_id == search_word.id %}
                                                                <tr>
                                                                    <th scope="row"></th>
                                                                    <td>{{ search_dish.dish_name }}</td>
                                                                    <td>
                                                                        {% for rest in restaurants %}
                                                                            {% if rest.id == search_dish.rest_id %}
                                                                                {{ rest.name }}
                                                                            {% endif %}
                                                                        {% endfor %}
                                                                    </td>
                                                                    <td>
                                                                        <form method="post">
                                                                            {{ search_dish_del_form.csrf_token(id="search_dish" + search_dish.id|string + "_delete_form_csrf") }}
                                                                            {{ search_dish_del_form.search_dish_id(hidden=true, value=search_dish.id, id="search_dish" + search_dish.id|string + "_delete_id") }}
                                                                            {{ search_dish_del_form.search_dish_del_submit(class="btn btn-danger", id="search_dish" + search_dish.id|string + "_delete_submit_field") }}
                                                                        </form>
                                                                    </td>
                                                                </tr>
                                                                {% endif %}
                                                            {% endfor %}
                                                        </tbody>
                                                    </table>
                                                    <button id="btnCmdAddDish_{{search_word.id}}" type="button" class="btn btn-primary">Добавить блюдо в команду</button>
                                                    <form id="searchDishAddForm_{{search_word.id}}" style="display:none;white-space:pre;" method="post" enctype="multipart/form-data">
                                                        {{ search_dish_form.csrf_token() }}
                                                        <table class="table">
                                                            <thead>
                                                                <tr>
                                                                    <th scope="col" colspan="2">Слова команды: {{ search_word.words }}</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                <tr>
                                                                    <th scope="row">{{ search_dish_form.rest_id.label }}</th>
                                                                    <td>
                                                                        {{ search_dish_form.rest_id(hidden=true) }}
                                                                        <select id="search_dish_rest_selector_{{search_word.id}}" name="search_dish_rest_selector_{{search_word.id}}" onchange="searchDishSelCategory_{{search_word.id}}();" required>
                                                                            <option selected disabled></option>
                                                                            {% for restaurant in restaurants %}
                                                                                <option value="{{ restaurant.id }}">{{ restaurant.name }}</option>
                                                                            {% endfor %}
                                                                        </select>
                                                                    </td>
                                                                </tr>
                                                                <tr>
                                                                    <th scope="row">Категория</th>
                                                                    <td>
                                                                        <select id="search_dish_cat_selector_{{search_word.id}}" name="search_dish_cat_selector_{{search_word.id}}" required>
                                                                            <option selected disabled></option>
                                                                        </select>
                                                                    </td>
                                                                </tr>
                                                                <tr>
                                                                    <th scope="row">{{ search_dish_form.dish_id.label }}</th>
                                                                    <td>
                                                                        {{ search_dish_form.dish_id(hidden=true) }}
                                                                        <select id="search_dish_selector_{{search_word.id}}" name="search_dish_selector_{{search_word.id}}" required>
                                                                            <option selected disabled></option>
                                                                        </select>
                                                                    </td>
                                                                </tr>
                                                                <tr>
                                                                    <th scope="row">{{ search_dish_form.search_word_id(hidden=true, value=search_word.id) }}</th>
                                                                    <td>{{ search_dish_form.search_dish_submit(class="btn btn-primary") }}</td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                    </form>
                                                    <script>
                                                        function searchDishSelCategory_{{search_word.id}}() {
                                                            let search_dish_category_select = document.getElementById('search_dish_cat_selector_{{search_word.id}}');
                                                            var category_options = '';
                                                            var search_dish_rest_id = document.getElementById('search_dish_rest_selector_{{search_word.id}}').value;
                                                            {% for category in categories %}
                                                                if ( search_dish_rest_id == {{ category.restaurant_id|safe }} ) {
                                                                    category_options += '<option value="{{ category.id|safe }}">{{ category.name|safe }}</option>>';
                                                                }
                                                            {% endfor %}
                                                            search_dish_category_select.innerHTML = category_options;
                                                            $('#search_dish_cat_selector_{{search_word.id}}').on('change', function() {
                                                                let search_dish_select = document.getElementById('search_dish_selector_{{search_word.id}}');
                                                                var dishes_options = '';
                                                                let search_dish_rest_id = $("#search_dish_rest_selector_{{search_word.id}}").val();
                                                                let search_dish_category_text = $("#search_dish_cat_selector_{{search_word.id}} option:selected").text();
                                                                {% for dish in dishes %}
                                                                    if (search_dish_rest_id == Number('{{ dish.id_rest }}') && search_dish_category_text == '{{ dish.category }}') {
                                                                        dishes_options += '<option value="{{ dish.id|safe }}">{{ dish.name|safe }}</option>';
                                                                    }
                                                                {% endfor %}
                                                                search_dish_select.innerHTML = dishes_options;
                                                            });
                                                        }
                                                    </script>
                                                </div>
                                                <br/>
                                                {% endfor %}
                                                <button id="btnAddCmd" type="button" class="btn btn-primary">Добавить команду</button>
                                                <form id="searchWordForm" style="display:none;white-space:pre;" method="post" enctype="multipart/form-data">
                                                    {{ search_word_form.csrf_token() }}
                                                    <table class="table">
                                                        <tr>
                                                            <th scope="row"></th>
                                                            <td>{{ search_word_form.search_name.label }}</td>
                                                            <td>{{ search_word_form.search_name }}</td>
                                                        </tr>
                                                        <tr>
                                                            <th scope="row"></th>
                                                            <td>{{ search_word_form.search_word.label }}</td>
                                                            <td>{{ search_word_form.search_word }}</td>
                                                        </tr>
                                                        <tr>
                                                            <th scope="row"></th>
                                                            <td>{{ search_word_form.search_word_submit(class="btn btn-success") }}</td>
                                                        </tr>
                                                    </table>
                                                </form>
                                                <button id="btnDelCmd" type="button" class="btn btn-secondary">Удалить команду</button>
                                                <form id="searchWordDelForm" style="display:none;white-space:pre;" method="post" enctype="multipart/form-data">
                                                    {{ search_word_del_form.csrf_token() }}
                                                    <table class="table">
                                                        <tr>
                                                            <th scope="row"></th>
                                                            <td>Выберите команду</td>
                                                        </tr>
                                                        <tr>
                                                            <th scope="row"></th>
                                                            <td>
                                                                {{ search_word_del_form.search_word(hidden=true) }}
                                                                <select id="search_word_selector" name="search_word_selector" required>
                                                                    <option selected disabled></option>
                                                                    {% for search_word in search_words %}
                                                                        <option value="{{ search_word.id }}">{{ search_word.name }}</option>
                                                                    {% endfor %}
                                                                </select>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <th scope="row"></th>
                                                            <td>{{ search_word_del_form.search_word_del_submit(class="btn btn-danger") }}</td>
                                                        </tr>
                                                    </table>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% else %}
                        <div class="card-header" id="heading{{ restaurant.id }}">
                            <h5 class="mb-0">
                                <button class="btn btn-link btn-block text-left collapsed" type="button" data-toggle="collapse" data-target="#collapse{{ restaurant.id }}" aria-expanded="false" aria-controls="collapse{{ restaurant.id }}">
                                    {{ restaurant.name }}
                                </button>
                            </h5>
                        </div>
                        <div id="collapse{{ restaurant.id }}" class="collapse" aria-labelledby="heading{{ restaurant.id }}" data-parent="#accordionRests">
                            <div class="card-body">
                                <div class="accordion" id="accordionAdminCategories">
                                    {% for category in categories %}
                                        {% if category.restaurant_id == restaurant.id %}
                                        <div class="card">
                                            <div class="card-header" id="headingAdminCategory{{category.id}}">
                                                <h5 class="mb-0">
                                                    <button class="btn btn-link btn-block text-left collapsed" type="button" data-toggle="collapse" data-target="#collapseAdminCategory{{category.id}}" aria-expanded="false" aria-controls="collapseAdminCategory{{category.id}}">
                                                        {{ category.name }}
                                                    </button>
                                                </h5>
                                            </div>
                                        </div>
                                        <div id="collapseAdminCategory{{category.id}}" class="collapse">
                                            <table class="table">
                                                <thead>
                                                    <tr>
                                                        <th scope="col">Название блюда</th>
                                                        <th scope="col">Стоимость</th>
                                                        <th scope="col">Описание</th>
                                                        <th scope="col">Категория</th>
                                                        <th scope="col">Изображение</th>
                                                        <th scope="col"></th>
                                                        <th scope="col"></th>
                                                        <th scope="col"></th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for dish in dishes %}
                                                        {% if dish.id_rest == restaurant.id and dish.category == category.name %}
                                                            <tr>
                                                                <td style="vertical-align: middle;" class="dishEdit">{{ dish.name }}</td>
                                                                <td style="vertical-align: middle;" class="dishEdit">{{ dish.cost }} р.</td>
                                                                <td style="vertical-align: middle;" class="dishEdit">{{ dish.composition }}</td>
                                                                <td style="vertical-align: middle;" class="dishEdit">{{ dish.category }}</td>
                                                                <td style="vertical-align: middle;" class="dishEdit"><img src="{{ dish.img_link }}" height=100 width=100 align="center"></td>
                                                                <td style="vertical-align: middle;" class="dishEdit"><button id="btnDishEdit{{ dish.id }}" type="button" class="btn btn-warning">Изменить</button></td>
                                                                <td style="vertical-align: middle;" class="dishEdit"><button id="btnDishStatus{{ dish.id }}" type="button" class="btn btn-info dish-status">{% if dish.status == True %}Выключить{% else %}Включить{% endif %}</button></td>
                                                                <td style="vertical-align: middle;" class="dishEdit">
                                                                    <form method="post">
                                                                        {{ dish_delete_form.csrf_token(id="dish" + dish.id|string + "_delete_form_csrf") }}
                                                                        {{ dish_delete_form.delete_id(value=dish.id, id="dish" + dish.id|string + "_delete_id") }}
                                                                        {{ dish_delete_form.dish_delete_submit(class="btn btn-danger", id="dish" + dish.id|string + "_delete_submit_field") }}
                                                                    </form>
                                                                </td>
                                                            </tr>
                                                            <form style="display:none;white-space:pre;" method="POST" enctype="multipart/form-data">
                                                                {{ dish_edit_form.csrf_token(id="dish_" + dish.id|string + "_edit_form_csrf") }}
                                                                {{ dish_edit_form.id_rest(value=dish.id_rest, style="display:none;") }}
                                                                {{ dish_edit_form.id_dish(value=dish.id, style="display:none;") }}
                                                                <tr class="dishEditForm{{ dish.id }}" style="display:none;">
                                                                    <td>{{ dish_edit_form.name.label }}</td>
                                                                    <td colspan="6">{{ dish_edit_form.name(value=dish.name, size="50") }}</td>
                                                                </tr>
                                                                <tr class="dishEditForm{{ dish.id }}" style="display:none;">
                                                                    <td>{{ dish_edit_form.cost.label }}</td>
                                                                    <td colspan="6">{{ dish_edit_form.cost(value=dish.cost, size="50") }}</td>
                                                                </tr>
                                                                <tr class="dishEditForm{{ dish.id }}" style="display:none;">
                                                                    <td>{{ dish_edit_form.composition.label }}</td>
                                                                    <td colspan="6">{{ dish_edit_form.composition(value=dish.composition, size="50") }}</td>
                                                                </tr>
                                                                <tr class="dishEditForm{{ dish.id }}" style="display:none;">
                                                                    <td>{{ dish_edit_form.category.label }}</td>
                                                                    <td colspan="6">{{ dish_edit_form.category(value=dish.category, size="50") }}</td>
                                                                </tr>
                                                                <tr class="dishEditForm{{ dish.id }}" style="display:none;">
                                                                    <td>{{ dish_edit_form.img_file.label }}</td>
                                                                    <td colspan="6">{{ dish_edit_form.img_file }}</td>
                                                                </tr>
                                                                <tr class="dishEditForm{{ dish.id }}" style="display:none;">
                                                                    <td>{{ dish_edit_form.dish_edit_submit(class="btn btn-warning", id="dish_" + dish.id|string + "_edit_submit_button") }}</td>
                                                                </tr>
                                                            </form>
                                                        {% endif %}
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                        {% endif %}
                                    {% endfor %}
                                </div>
                                <button id="btnRestEdit{{ restaurant.id }}" type="button">Изменить данные ресторана</button>
                                <form id="restEdit{{ restaurant.id }}" style="display:none;white-space:pre;" method="POST" enctype="multipart/form-data">
                                    <table class="table">
                                        {{ restaurant_edit_form.csrf_token(id="restaurant" + restaurant.id|string + "_edit_form_csrf") }}
                                        {{ restaurant_edit_form.id(value=restaurant.id, style="display:none;", id="restaurant" + restaurant.id|string + "_edit_form_id_field") }}
                                        <tr>
                                            <td>{{ restaurant_edit_form.name.label }}</td>
                                            <td>{{ restaurant_edit_form.name(value=restaurant.name, size="50", id="rest" + restaurant.id|string + "_name_field") }}</td>
                                        </tr>
                                        <tr>
                                            <td>{{ restaurant_edit_form.address.label }}</td>
                                            <td>{{ restaurant_edit_form.address(value=restaurant.address, size="50", id="rest" + restaurant.id|string + "_address_field") }}</td>
                                        </tr>
                                        <tr>
                                            <td>{{ restaurant_edit_form.contact.label }}</td>
                                            <td>{{ restaurant_edit_form.contact(value=restaurant.contact, size="50", id="rest" + restaurant.id|string + "_contact_field") }}</td>
                                        </tr>
                                        <tr>
                                            <td>{{ restaurant_edit_form.passwd.label }}</td>
                                            <td>{{ restaurant_edit_form.passwd(value=restaurant.passwd, size="50", id="rest" + restaurant.id|string + "_passwd_field") }}</td>
                                        </tr>
                                        <tr>
                                            <td>{{ restaurant_edit_form.email.label }}</td>
                                            <td>{{ restaurant_edit_form.email(value=restaurant.email, size="50", id="email" + restaurant.id|string + "_email_field") }}</td>
                                        </tr>
                                        <tr>
                                            <td>{{ restaurant_edit_form.min_total.label }}</td>
                                            <td>{{ restaurant_edit_form.min_total(value=restaurant.min_total, id="min_total_rest" + restaurant.id|string) }}</td>
                                        </tr>
                                        <tr>
                                            <td>{{ restaurant_edit_form.rest_edit_submit(class="btn btn-warning", id="restaurant" + restaurant.id|string + "_edit_submit_field") }}</td>
                                        </tr>
                                    </table>
                                </form>
                                <button id="btnRestInfo{{ restaurant.id }}" type="button">Информация клиенту</button>
                                <form id="restInfo{{ restaurant.id }}" style="display:none;white-space:pre;" method="POST" enctype="multipart/form-data">
                                    <table class="table">
                                        {{ restaurant_info_form.csrf_token(id="restaurant" + restaurant.id|string + "_info_form_csrf") }}
                                        {{ restaurant_info_form.rest_id(value=restaurant.id, style="display:none;") }}
                                        <tr>
                                            <td>{{ restaurant_info_form.rest_img.label }}</td>
                                            <td>{{ restaurant_info_form.rest_img }}</td>
                                        </tr>
                                        <tr>
                                            <td>{{ restaurant_info_form.delivery_time.label }}</td>
                                            <td>{{ restaurant_info_form.delivery_time }}</td>
                                        </tr>
                                        <tr>
                                            <td>{{ restaurant_info_form.takeaway_address.label }}</td>
                                            <td>{{ restaurant_info_form.takeaway_address }}</td>
                                        </tr>
                                        <tr>
                                            <td>{{ restaurant_info_form.rest_info_submit(class="btn btn-success", id="restaurant" + restaurant.id|string + "_info_submit_field") }}</td>
                                        </tr>
                                    </table>
                                </form>
                                <button id="btnRestDisable{{ restaurant.id }}" type="button">Статус</button>
                                <form id="restDisable{{ restaurant.id }}" style="display:none;white-space:pre;" method="POST" enctype="multipart/form-data">
                                    <table class="table">
                                        {{ restaurant_enable_form.csrf_token(id="restaurant" + restaurant.id|string + "_toggle_form_csrf") }}
                                        {{ restaurant_enable_form.rest_id(value=restaurant.id, style="display:none;") }}
                                        {% if restaurant.enabled == True %}
                                        {{ restaurant_enable_form.status(value=false, style="display:none;") }}
                                        <tr>
                                            <label>Включен</label>
                                        </tr>
                                        <tr>
                                            <td>{{ restaurant_enable_form.rest_enable_submit(value="Выключить", class="btn btn-warning", id="restaurant" + restaurant.id|string + "_disable_submit_field") }}</td>
                                        </tr>
                                        {% elif restaurant.enabled == False %}
                                        {{ restaurant_enable_form.status(value=1, style="display:none;") }}
                                        <tr>
                                            <label>Выключен</label>
                                        </tr>
                                        <tr>
                                            <td>{{ restaurant_enable_form.rest_enable_submit(value="Включить", class="btn btn-warning", id="restaurant" + restaurant.id|string + "_enable_submit_field") }}</td>
                                        </tr>
                                        {% endif %}
                                    </table>
                                </form>
                            </div>
                        </div>
                        {% endif %}
                        {% endfor %}
                    </div>
                </div>
        {% else %}
            {% for restaurant in restaurants %}
                {% if restaurant.name == current_user.ownership %}
                    {% set ns.rest_id = restaurant.id %}
                {% endif %}
            {% endfor %}
            <ul>Вы администратор ресторана {{ current_user.ownership }}</ul>
            <div class="accordion" id="accordionDishes">
                <div class="card">
                    <div class="card-header" id="headingDishes">
                        <h5 class="mb-0">
                            <button class="btn btn-link btn-block text-left collapsed" type="button" data-toggle="collapse" data-target="#collapseDishes" aria-expanded="false" aria-controls="collapseDishes">
                                Показать блюда
                            </button>
                        </h5>
                    </div>
                    <div id="collapseDishes" class="collapse" aria-labelledby="headingDishes" data-parent="#accordionDishes">
                        <div class="card-body">
                            <div class="accordion" id="accordionCategories">
                                {% for restaurant in restaurants %}
                                    {% if current_user.ownership == restaurant.name %}
                                        {% for category in categories %}
                                            {% if category.restaurant_id == restaurant.id %}
                                                <div class="card">
                                                    <div class="card-header" id="headingCategory{{category.id}}">
                                                        <h5 class="mb-0">
                                                            <button class="btn btn-link btn-block text-left collapsed" type="button" data-toggle="collapse" data-target="#collapseCategory{{category.id}}" aria-expanded="false" aria-controls="collapseCategory{{category.id}}">
                                                                {{ category.name }}
                                                            </button>
                                                        </h5>
                                                    </div>
                                                    <div id="collapseCategory{{category.id}}" class="collapse" aria-labelledby="headingCategory{{category.id}}" data-parent="#accordionCategories">
                                                        <div class="card-body">
                                                            <table class="table">
                                                                <thead>
                                                                    <tr>
                                                                        <th scope="col">Название блюда</th>
                                                                        <th scope="col">Стоимость</th>
                                                                        <th scope="col">Описание</th>
                                                                        <th scope="col">Категория</th>
                                                                        <th scope="col">Изображение</th>
                                                                        <th scope="col"></th>
                                                                        <th scope="col"></th>
                                                                        <th scope="col"></th>
                                                                    </tr>
                                                                </thead>
                                                            {% for dish in dishes %}
                                                                {% if dish.id_rest == restaurant.id and dish.category == category.name %}
                                                                    <tbody>
                                                                        <tr>
                                                                            <td style="vertical-align: middle;">{{ dish.name }}</td>
                                                                            <td style="vertical-align: middle;">{{ dish.cost }} р.</td>
                                                                            <td style="vertical-align: middle;">{{ dish.composition }}</td>
                                                                            <td style="vertical-align: middle;">{{ dish.category }}</td>
                                                                            <td style="vertical-align: middle;"><img src="{{ dish.img_link }}" height=100 width=100 align="center"></td>
                                                                            <td style="vertical-align: middle;" class="dishEditRest"><button id="btnDishEditRest{{ dish.id }}" type="button" class="btn btn-warning">Изменить</button></td>
                                                                            <td style="vertical-align: middle;" class="dishStatusRest"><button id="btnDishStatusRest{{ dish.id }}" type="button" class="btn btn-info">Статус</button></td>
                                                                            <td style="vertical-align: middle;">
                                                                                <form method="post">
                                                                                    {{ dish_delete_form.csrf_token(id="dish" + dish.id|string + "_delete_form_csrf") }}
                                                                                    {{ dish_delete_form.delete_id(value=dish.id, id="dish" + dish.id|string + "_delete_id") }}
                                                                                    {{ dish_delete_form.dish_delete_submit(class="btn btn-danger", id="dish" + dish.id|string + "_delete_submit_field") }}
                                                                                </form>
                                                                            </td>
                                                                        </tr>
                                                                        <form style="display:none;white-space:pre;" method="POST" enctype="multipart/form-data">
                                                                            {{ dish_edit_form.csrf_token(id="dish_" + dish.id|string + "_edit_rest_form_csrf") }}
                                                                            {{ dish_edit_form.id_rest(value=dish.id_rest, style="display:none;") }}
                                                                            {{ dish_edit_form.id_dish(value=dish.id, style="display:none;") }}
                                                                            <tr class="dishEditRestForm{{ dish.id }}" style="display:none;">
                                                                                <td>{{ dish_edit_form.name.label }}</td>
                                                                                <td colspan="6">{{ dish_edit_form.name(value=dish.name, size="50") }}</td>
                                                                            </tr>
                                                                            <tr class="dishEditRestForm{{ dish.id }}" style="display:none;">
                                                                                <td>{{ dish_edit_form.cost.label }}</td>
                                                                                <td colspan="6">{{ dish_edit_form.cost(value=dish.cost, size="50") }}</td>
                                                                            </tr>
                                                                            <tr class="dishEditRestForm{{ dish.id }}" style="display:none;">
                                                                                <td>{{ dish_edit_form.composition.label }}</td>
                                                                                <td colspan="6">{{ dish_edit_form.composition(value=dish.composition, size="50") }}</td>
                                                                            </tr>
                                                                            <tr class="dishEditRestForm{{ dish.id }}" style="display:none;">
                                                                                <td>{{ dish_edit_form.category.label }}</td>
                                                                                <td colspan="6">{{ dish_edit_form.category(value=dish.category, size="50") }}</td>
                                                                            </tr>
                                                                            <tr class="dishEditRestForm{{ dish.id }}" style="display:none;">
                                                                                <td>{{ dish_edit_form.img_file.label }}</td>
                                                                                <td colspan="6">{{ dish_edit_form.img_file }}</td>
                                                                            </tr>
                                                                            <tr class="dishEditRestForm{{ dish.id }}" style="display:none;">
                                                                                <td>{{ dish_edit_form.dish_edit_submit(class="btn btn-warning", id="dish_" + dish.id|string + "_edit_rest_submit_button") }}</td>
                                                                            </tr>
                                                                        </form>
                                                                    </tbody>
                                                                {% endif %}
                                                            {% endfor %}
                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>
                                            {% endif %}
                                        {% endfor %}
                                    {% endif %}
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        {% endif %}
    <div class="accordion" id="accordionExample">
        <div class="card">
            <div class="card-header" id="headingTwo">
                <h5 class="mb-0">
                    <button class="btn btn-link btn-block text-left collapsed" type="button" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                        Добавить блюдо
                    </button>
                </h5>
            </div>
            <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordionExample">
                <div class="card-body">
                    <form method="post" enctype="multipart/form-data">

                        {{ dish_form.csrf_token(id="dish_add_form_csrf") }}
                        <table class="table">
                            <tr>
                                <td>{{ dish_form.name.label }}</td>
                                <td >{{ dish_form.name(id="dish_add_name_field") }}</td>
                            </tr>
                            <tr>
                                <td>{{ dish_form.cost.label }}</td>
                                <td>{{ dish_form.cost }}</td>
                            </tr>
                            <tr>
                                <td>{{ dish_form.composition.label }}</td>
                                <td>{{ dish_form.composition }}</td>
                            </tr>
                            <tr>
                                <td>{{ dish_form.img_file.label }}</td>
                                <td>{{ dish_form.img_file }}</td>
                            </tr>
                            {% if current_user.ownership != 'all' %}
                                {{ dish_form.id_rest(value=ns.rest_id) }}
                                <tr>
                                    <td>{{ dish_form.category.label }}</td>
                                    <td>
                                        <select id="dish_add_category_selector" name="dish_add_category_selector" required>
                                            <option selected disabled hidden></option>
                                            {% for category in categories %}
                                                {% if category.restaurant_id == ns.rest_id %}
                                                    <option value="{{ category.name }}">{{ category.name }}</option>
                                                {% endif %}
                                            {% endfor %}
                                        </select>
                                        {{ dish_form.category(hidden=True) }}
                                    </td>
                                </tr>
                            {% else %}
                                <tr>
                                    <td>Укажите ресторан</td>
                                    <td>
                                        <select id="dish_add_rest_selector" name="dish_add_rest_selector" onchange="dishAddCategory();" required>
                                            <option selected disabled hidden></option>
                                            {% for restaurant in restaurants %}
                                                <option value="{{ restaurant.id }}">{{ restaurant.name }}</option>
                                            {% endfor %}
                                        </select>
                                        {{ dish_form.id_rest(hidden=True) }}
                                    </td>
                                </tr>
                                <tr>
                                    <td>{{ dish_form.category.label }}</td>
                                    <td>
                                        <select id="dish_add_admin_category_selector" name="dish_add_admin_category_selector" required>
                                            <option selected disabled hidden></option>
                                        </select>
                                        {{ dish_form.category(hidden=True) }}
                                    </td>
                                </tr>
                            {% endif %}
                            <tr>
                                <td>{{ dish_form.dish_add_submit }}</td>
                            </tr>
                        </table>
                    </form>
                    <script>
                        function dishAddCategory() {
                            let admin_category_select = document.getElementById('dish_add_admin_category_selector');
                            let optionsHTMLCategory = '';
                            var dish_rest_id = document.getElementById('dish_add_rest_selector').value;
                            {% for category in categories %}
                                if ( dish_rest_id == {{ category.restaurant_id|safe }} ) {
                                    optionsHTMLCategory += '<option value="{{ category.name|safe }}">{{ category.name|safe }}</option>';
                                }
                            {% endfor %}
                            admin_category_select.innerHTML = optionsHTMLCategory;
                        }
                    </script>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header" id="headingPromo">
                <h2 class="mb-0">
                    <button class="btn btn-link btn-block text-left collapsed" type="button" data-toggle="collapse" data-target="#collapsePromo" aria-expanded="false" aria-controls="collapsePromo">
                        Добавить Акцию
                    </button>
                </h2>
            </div>
            <div id="collapsePromo" class="collapse" aria-labelledby="headingPromo" data-parent="#accordionExample">
                <div class="card-body">
                    <table class="table">
                        <thead>
                            <tr>
                                <th scope="col">Изображение акции</th>
                                <th scope="col"></th>
                            </tr>
                        </thead>
                        <tbody>
                        {% for promo_dish in promo_dishes %}
                            {% if promo_dish.rest_id == ns.rest_id %}
                                <tr>
                                    <td style="vertical-align: middle;"><img src="{{ promo_dish.img_link }}" height=100 width=100 align="center"></td>
                                </tr>
                            {% endif %}
                        {% endfor %}
                        </tbody>
                    </table>
                    <button id="btnAddPromoRest" type="button">Добавить акцию</button>
                    <form id="promoDishAddFormRest" style="display:none;white-space:pre;" method="post" enctype="multipart/form-data" action="/admin">
                        {{ promo_dishes_form.csrf_token() }}
                        <table class="table">
                            {{ promo_dishes_form.rest_id(hidden=true, value=ns.rest_id) }}
                            {{ promo_dishes_form.selected(hidden=true, value=False) }}
                            <tr>
                                <td>{{ promo_dishes_form.img_file.label }}</td>
                                <td>{{ promo_dishes_form.img_file }}</td>
                            </tr>
                            <tr>
                                <td>
                                    {{ promo_dishes_form.promo_dish_submit(class="btn btn-warning") }}
                                </td>
                            </tr>
                        </table>
                    </form>
                    <form id="promoDishDelFormRest" method="post" enctype="multipart/form-data">
                        {{ promo_dishes_delete_form.csrf_token() }}
                        {{ promo_dishes_delete_form.promo_rest_id(value=ns.rest_id, hidden=true) }}
                        {{ promo_dishes_delete_form.promo_dish_delete_submit() }}
                    </form>
                    <div style="margin-bottom:10px"></div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header" id="headingThree">
                <h2 class="mb-0">
                    <button class="btn btn-link btn-block text-left collapsed" type="button" data-toggle="collapse" data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                        Добавить категорию
                    </button>
                </h2>
            </div>
            <div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#accordionExample">
                <div class="card-body">
                    <form action="" method="post">
                        {{ category_form.csrf_token(id="category_add_form_csrf") }}

                        <table class="table">
                            {% if ns.rest_id != 0 %}
                                <tr>
                                    <td>{{ category_form.name.label }}</td>
                                    <td>{{ category_form.name(id="rest" + ns.rest_id|string + "_category_add_name_field") }}</td>
                                </tr>
                                <tr>
                                    <td>
                                        {{ category_form.restaurant_id(value=ns.rest_id) }}
                                    </td>
                                </tr>
                            {% else %}
                                <tr>
                                    <td>Укажите ресторан</td>
                                    <td>
                                        <select id="category_add_rest_selector" name="category_add_rest_selector" required>
                                            <option selected disabled hidden></option>
                                            {% for restaurant in restaurants %}
                                                <option value="{{ restaurant.id }}">{{ restaurant.name }}</option>
                                            {% endfor %}
                                        </select>
                                        {{ category_form.restaurant_id(hidden=true) }}
                                    </td>
                                </tr>
                                <tr>
                                    <td>{{ category_form.name.label }}</td>
                                    <td>{{ category_form.name(id="rest" + ns.rest_id|string + "_category_add_name_field") }}</td>
                                </tr>
                            {% endif %}

                            <tr>
                                <td>{{ category_form.category_add_submit }}</td>
                            </tr>
                        </table>
                    </form>
                </div>
            </div>
        </div>
        <div class="card">
            <div class="card-header" id="headingFour">
                <h2 class="mb-0">
                    <button class="btn btn-link btn-block text-left collapsed" type="button" data-toggle="collapse" data-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
                        Удалить категорию
                    </button>
                </h2>
            </div>
            <div id="collapseFour" class="collapse" aria-labelledby="headingFour" data-parent="#accordionExample">
                <div class="card-body">
                    <form method="post">
                        {{ category_delete_form.csrf_token(id="category_delete_form_csrf") }}
                        <table class="table">
                            {% if current_user.ownership != 'all' %}
                                <tr>
                                    <td>
                                        {{ category_delete_form.restaurant_id(value=ns.rest_id) }}
                                    </td>
                                </tr>
                                <tr>
                                    <td>{{ category_delete_form.name.label }}</td>
                                    <td>
                                        <select id="category_rest_delete_select_field" name="category_rest_delete_select_field" required>
                                            <option selected disabled hidden></option>
                                            {% for category in categories %}
                                                {% if category.restaurant_id == ns.rest_id %}
                                                    <option value="{{ category.name|safe }}">{{ category.name|safe }}</option>
                                                {% endif %}
                                            {% endfor %}
                                        </select>
                                        {{ category_delete_form.name(id="category_delete_name_field", hidden=True) }}
                                    </td>
                                </tr>
                            {% else %}
                                <tr>
                                    <td>Укажите ресторан</td>
                                    <td>
                                        <select id="category_del_rest_selector" name="category_del_rest_selector" onchange="showCategories();" required>
                                            <option selected disabled hidden></option>
                                            {% for restaurant in restaurants %}
                                                <option value="{{ restaurant.id }}">{{ restaurant.name }}</option>
                                            {% endfor %}
                                        </select>
                                        {{ category_delete_form.restaurant_id(hidden=True) }}
                                    </td>
                                </tr>
                                <tr>
                                    <td>{{ category_delete_form.name.label }}</td>
                                    <td>
                                        <select id="category_delete_select_field" name="category_delete_select_field" required>
                                            <option selected disabled hidden></option>
                                        </select>
                                        {{ category_delete_form.name(id="category_delete_name_field", hidden=True) }}
                                    </td>
                                </tr>
                            {% endif %}
                            <tr>
                                <td>{{ category_delete_form.category_delete_submit }}</td>
                            </tr>
                        </table>
                    </form>
                </div>
            </div>
            <script>
                function showCategories() {
                    let category_select = document.getElementById('category_delete_select_field');
                    let optionHTML = '';
                    if ({{ ns.rest_id|int }} != 0) {
                        {% for category in categories %}
                            {% if category.restaurant_id == ns.rest_id %}
                                optionHTML += '<option value="{{ category.name|safe }}">{{ category.name|safe }}</option>';
                            {% endif %}
                        {% endfor %}
                        category_select.innerHTML = optionHTML;
                    } else {
                        var rest_id = document.getElementById('category_del_rest_selector').value;
                        {% for category in categories %}
                            if ( rest_id == {{ category.restaurant_id|safe }} ) {
                                optionHTML += '<option value="{{ category.name|safe }}">{{ category.name|safe }}</option>';
                            }
                        {% endfor %}
                        category_select.innerHTML = optionHTML;
                    }
                }
            </script>
        </div>
        {% if current_user.ownership != 'all' %}
            <div class="card">
                <div class="card-header" id="headingFive">
                    <h2 class="mb-0">
                        <button class="btn btn-link btn-block text-left collapsed" type="button" data-toggle="collapse" data-target="#collapseFive" aria-expanded="false" aria-controls="collapseFive">
                            Условия доставки
                        </button>
                    </h2>
                </div>
                <div id="collapseFive" class="collapse" aria-labelledby="headingFive" data-parent="#accordionExample">
                    <div class="card-body">
                        <p>Можете внести изменения в любое поле</p>
                        {% for term in delivery_terms %}
                            {% if term.rest_id == ns.rest_id %}
                                {% set ns.condition = True %}
                                <form method="post" enctype="multipart/form-data">
                                    {{ rest_delivery_terms_edit_form.csrf_token(id="rest_delivery_form_csrf") }}
                                    <table class="table">
                                        {{ rest_delivery_terms_edit_form.rest_id(value=ns.rest_id) }}
                                        <tr>
                                            <td>{{ rest_delivery_terms_edit_form.terms.label }}</td>
                                            <td>{{ rest_delivery_terms_edit_form.terms }}</td>
                                        </tr>
                                        <tr>
                                            <td>{{ rest_delivery_terms_edit_form.rest_inn.label }}</td>
                                            <td>{{ rest_delivery_terms_edit_form.rest_inn }}</td>
                                        </tr>
                                        <tr>
                                            <td>{{ rest_delivery_terms_edit_form.rest_ogrn.label }}</td>
                                            <td>{{ rest_delivery_terms_edit_form.rest_ogrn }}</td>
                                        </tr>
                                        <tr>
                                            <td>{{ rest_delivery_terms_edit_form.rest_fullname.label }}</td>
                                            <td>{{ rest_delivery_terms_edit_form.rest_fullname(id="rest" + ns.rest_id|string + "_delivery_terms_fullname_field") }}</td>
                                        </tr>
                                        <tr>
                                            <td>{{ rest_delivery_terms_edit_form.rest_address.label }}</td>
                                            <td>{{ rest_delivery_terms_edit_form.rest_address }}</td>
                                        </tr>
                                        <tr>
                                            <td>{{ rest_delivery_terms_edit_form.terms_edit_submit }}</td>
                                        </tr>
                                    </table>
                                </form>
                            {% endif %}
                        {% endfor %}
                        {% if not ns.condition %}
                            <form method="post" enctype="multipart/form-data">
                                {{ rest_delivery_terms_form.csrf_token() }}
                                <table class="table">
                                    {{ rest_delivery_terms_form.rest_id(value=ns.rest_id) }}
                                    <tr>
                                        <td>{{ rest_delivery_terms_form.terms.label }}</td>
                                        <td>{{ rest_delivery_terms_form.terms }}</td>
                                    </tr>
                                    <tr>
                                        <td>{{ rest_delivery_terms_form.rest_inn.label }}</td>
                                        <td>{{ rest_delivery_terms_form.rest_inn }}</td>
                                    </tr>
                                    <tr>
                                        <td>{{ rest_delivery_terms_form.rest_ogrn.label }}</td>
                                        <td>{{ rest_delivery_terms_form.rest_ogrn }}</td>
                                    </tr>
                                    <tr>
                                        <td>{{ rest_delivery_terms_form.rest_fullname.label }}</td>
                                        <td>{{ rest_delivery_terms_form.rest_fullname(id="rest" + ns.rest_id|string + "_delivery_terms_fullname_field") }}</td>
                                    </tr>
                                    <tr>
                                        <td>{{ rest_delivery_terms_form.rest_address.label }}</td>
                                        <td>{{ rest_delivery_terms_form.rest_address }}</td>
                                    </tr>
                                    <tr>
                                        <td>{{ rest_delivery_terms_form.delivery_terms_submit }}</td>
                                    </tr>
                                </table>
                            </form>
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-header" id="headingSix">
                    <h2 class="mb-0">
                        <button class="btn btn-link btn-block text-left collapsed" type="button" data-toggle="collapse" data-target="#collapseSix" aria-expanded="false" aria-controls="collapseSix">
                            Статус
                        </button>
                    </h2>
                </div>
                <div id="collapseSix" class="collapse" aria-labelledby="headingSix" data-parent="#accordionExample">
                    <div class="card-body">
                        <form id="restDisable{{ ns.rest_id }}_lk" method="POST" enctype="multipart/form-data">
                            <table class="table">
                                {% for restaurant in restaurants %}
                                    {% if restaurant.id == ns.rest_id %}
                                        {{ restaurant_enable_form.csrf_token(id="restaurant" + restaurant.id|string + "_toggle_form_lk_csrf") }}
                                        {{ restaurant_enable_form.rest_id(value=restaurant.id, style="display:none;") }}
                                        {% if restaurant.enabled == True %}
                                        {{ restaurant_enable_form.status(value=false, style="display:none;") }}
                                        <tr>
                                            <label>Включен</label>
                                        </tr>
                                        <tr>
                                            <td>{{ restaurant_enable_form.rest_enable_submit(value="Выключить", class="btn btn-warning", id="restaurant" + restaurant.id|string + "_disable_submit_field") }}</td>
                                        </tr>
                                        {% elif restaurant.enabled == False %}
                                        {{ restaurant_enable_form.status(value=1, style="display:none;") }}
                                        <tr>
                                            <label>Выключен</label>
                                        </tr>
                                        <tr>
                                            <td>{{ restaurant_enable_form.rest_enable_submit(value="Включить", class="btn btn-warning", id="restaurant" + restaurant.id|string + "_enable_submit_field") }}</td>
                                        </tr>
                                        {% endif %}
                                    {% endif %}
                                {% endfor %}
                            </table>
                        </form>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>
    {% if current_user.ownership == 'all' %}
        <div class="accordion" id="accordionRest">
            <div class="card">
                <div class="card-header" id="headingRest">
                    <h5 class="mb-0">
                        <button class="btn btn-link btn-block text-left collapsed" type="button" data-toggle="collapse" data-target="#collapseRest" aria-expanded="false" aria-controls="collapseRest">
                            Добавить ресторан
                        </button>
                    </h5>
                </div>
                <div id="collapseRest" class="collapse" aria-labelledby="headingRest" data-parent="#accordionRest">
                    <div class="card-body">
                        <form method="post" enctype="multipart/form-data">
                            {{ restaurant_form.csrf_token(id="restaurant_add_form_csrf") }}
                            <table class="table">
                                <tr>
                                    <td>{{ restaurant_form.name.label }}</td>
                                    <td>{{ restaurant_form.name(id="rest_add_name_field") }}</td>
                                </tr>
                                <tr>
                                    <td>{{ restaurant_form.address.label }}</td>
                                    <td>{{ restaurant_form.address }}</td>
                                </tr>
                                <tr>
                                    <td>{{ restaurant_form.contact.label }}</td>
                                    <td>{{ restaurant_form.contact }}</td>
                                </tr>
                                <tr>
                                    <td>{{ restaurant_form.passwd.label }}</td>
                                    <td>{{ restaurant_form.passwd(id="rest_add_passwd_field") }}</td>
                                </tr>
                                <tr>
                                    <td>{{ restaurant_form.email.label }}</td>
                                    <td>{{ restaurant_form.email }}</td>
                                </tr>
                                <tr>
                                    {{ restaurant_form.service_uid(value=None) }}
                                </tr>
                                <tr>
                                    <td>{{ restaurant_form.rest_add_submit }}</td>
                                </tr>
                            </table>
                        </form>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-header" id="headingRestDelete">
                    <h5 class="mb-0">
                        <button class="btn btn-link btn-block text-left collapsed" type="button" data-toggle="collapse" data-target="#collapseRestDelete" aria-expanded="false" aria-controls="collapseRestDelete">
                            Удалить ресторан
                        </button>
                    </h5>
                </div>
                <div id="collapseRestDelete" class="collapse" aria-labelledby="headingRestDelete" data-parent="#accordionRest">
                    <div class="card-body">
                        <form method="post" enctype="multipart/form-data">
                            {{ restaurant_delete_form.csrf_token(id="restaurant_delete_form_csrf") }}
                            <table class="table">
                                <tr>
                                    <td>{{ restaurant_delete_form.name.label }}</td>
                                    <!--<td>{{ restaurant_delete_form.name(id="rest_delete_name_field") }}</td>-->
                                    <td>
                                        <select id="rest_delete_name_field" name="rest_delete_select_field" required>
                                            <option selected disabled hidden></option>
                                            {% for restaurant in restaurants %}
                                                <option value="{{ restaurant.name|safe }}">{{ restaurant.name|safe }}</option>
                                            {% endfor %}
                                        </select>
                                    </td>
                                </tr>
                                <tr>
                                    <td>{{ restaurant_delete_form.rest_delete_submit }}</td>
                                </tr>
                            </table>
                        </form>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-header" id="adminAdd">
                    <h5 class="mb-0">
                        <button class="btn btn-link btn-block text-left collapsed" type="button" data-toggle="collapse" data-target="#collapseAdminAdd" aria-expanded="false" aria-controls="collapseAdminAdd">
                            Добавить пользователя
                        </button>
                    </h5>
                </div>
                <div id="collapseAdminAdd" class="collapse" aria-labelledby="adminAdd" data-parent="#accordionRest">
                    <div class="card-body">
                        <form method="POST" enctype="multipart/form-data">
                            <table class="table">
                                {{ admin_add_form.csrf_token(id="admin_add_form_csrf") }}
                                <tr>
                                    <td>{{ admin_add_form.username.label }}</td>
                                    <td>{{ admin_add_form.username(size="50") }}</td>
                                </tr>
                                <tr>
                                    <td>{{ admin_add_form.passwd.label }}</td>
                                    <td>{{ admin_add_form.passwd(type="password", size="50") }}</td>
                                </tr>
                                <tr>
                                    <td>{{ admin_add_form.email.label }}</td>
                                    <td>{{ admin_add_form.email(type="email", size="50", id="user_email") }}</td>
                                </tr>
                                <tr>
                                    <td>{{ admin_add_form.ownership.label }}</td>
                                    <td>
                                        <select id="admin_add_rest_selector" name="admin_add_rest_selector" required>
                                            <option selected disabled hidden></option>
                                            {% for restaurant in restaurants %}
                                                <option value="{{ restaurant.name }}">{{ restaurant.name }}</option>
                                            {% endfor %}
                                        </select>
                                        {{ admin_add_form.ownership(hidden=True) }}
                                    </td>
                                </tr>
                                <tr>
                                    <td>{{ admin_add_form.admin_add_button(class="btn btn-success") }}</td>
                                </tr>
                            </table>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}

{% endblock %}
